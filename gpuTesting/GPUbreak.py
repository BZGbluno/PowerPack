# make a dataFrame

import pandas as pd
import matplotlib.pyplot as plt


data = pd.read_csv("./temperature.txt")

data['temperature.gpu'] = pd.to_numeric(data['temperature.gpu'], errors="coerce")




allTimes = [[4.76837158203125e-07, 4.570997953414917], [19.58608865737915, 23.923283338546753], [38.93834352493286, 43.36220455169678], [58.377087354660034, 62.72157168388367], [77.73617935180664, 82.01827001571655], [97.03308963775635, 101.29718327522278], [116.31208920478821, 120.69381928443909], [135.70818400382996, 140.05156350135803], [155.06618928909302, 159.46101880073547], [174.4751958847046, 178.71696496009827], [193.73118710517883, 198.1016228199005], [213.11621284484863, 217.63538098335266], [232.65021586418152, 237.4402129650116], [252.45521116256714, 256.74063754081726], [271.7430648803711, 276.1087248325348], [291.1230592727661, 295.47433376312256], [310.4890537261963, 314.5843577384949], [329.599081993103, 333.8937203884125], [348.91098403930664, 353.5593595504761], [368.57408332824707, 372.8648991584778], [387.87908577919006, 392.24818873405457], [407.26316809654236, 411.5670108795166], [426.5811676979065, 430.8763642311096], [445.89116978645325, 450.14897656440735], [465.16316318511963, 469.42105531692505], [484.43617010116577, 488.7464051246643], [503.7611606121063, 508.0528519153595], [523.0671963691711, 527.4411089420319], [542.456179857254, 546.6680915355682], [561.6831583976746, 565.9599344730377], [580.9741604328156, 585.4470574855804], [600.4622106552124, 604.7852132320404], [619.8002119064331, 624.1744956970215], [639.1892206668854, 643.7582504749298], [658.773209810257, 663.0330469608307], [678.0472164154053, 682.450576543808], [697.4652137756348, 701.7293100357056], [716.7442243099213, 721.1967327594757], [736.2112262248993, 740.5241222381592], [755.5394015312195, 759.8150227069855], [774.8292245864868, 779.1716599464417], [794.1867413520813, 798.4630134105682], [813.4772455692291, 817.7949285507202], [832.809237241745, 837.1018874645233], [852.1162648200989, 856.7120485305786], [871.7272839546204, 876.2622079849243], [891.2742729187012, 895.563570022583], [910.5782687664032, 915.113612651825], [930.1287770271301, 934.3966875076294], [949.411262512207, 953.7454349994659], [968.760276556015, 973.127228975296], [988.142270565033, 992.3360540866852], [1007.3512263298035, 1011.566174030304], [1026.5813677310944, 1030.7823367118835], [1045.7973084449768, 1050.068358182907], [1065.0833365917206, 1069.3583071231842], [1084.3603191375732, 1088.6176385879517], [1103.632295370102, 1107.8517229557037], [1122.866342306137, 1127.1587750911713], [1142.1732954978943, 1146.467619895935], [1161.4822988510132, 1165.734246969223], [1180.749407529831, 1184.9742925167084], [1199.989295721054, 1204.242131948471], [1219.2573425769806, 1223.5570669174194], [1238.5712716579437, 1242.929235458374], [1257.944262266159, 1262.2641525268555], [1277.279648065567, 1281.521454334259], [1296.5362644195557, 1300.7254674434662], [1315.7402703762054, 1319.9833517074585], [1334.9982645511627, 1339.5681054592133], [1354.5832614898682, 1358.8868494033813]]
startTimeOfBrokenRound = 0



# data['cleaned'] = data.dropna()


time = []
for index, x in enumerate(data['temperature.gpu']):
    time.append(index)


data['times'] = time
length = len(data)
time = length / 100


df_cleaned = data.dropna()

plt.plot(df_cleaned["times"], df_cleaned['temperature.gpu'])


plt.xlabel("Times (seconds)")
plt.ylabel("Temperature (Celcius)")



plt.title("Change of Temperature of GPU V100 when Matrix Multiplying 1024x1024 by 1024x1024 \n 10 times every 15 seconds")

# Adds the thermal Shutdown
plt.axhline(y=92, color ='b', linestyle = '--', label = "Thermal Shutdown")

#Adds all of the vertical asymtotes that represent when the work started and ended
for work in allTimes:
    
    plt.axvline(x=work[0], color = 'g', linestyle = '-', label = "Work Start Time")
    plt.axvline(x=work[1], color = 'r', linestyle = '-', label = "Work End Time")


# Adds the final vertical asymtote before the GPU broke
plt.axvline(x=startTimeOfBrokenRound, color = 'g', linestyle = '-', label = "Work Start Time")

# Diplay the legend
handle1 = plt.Line2D([0], [0], color = 'blue', linestyle= "--", label='Thermal Shutdown')
handle2 = plt.Line2D([0], [0], color = 'green', linestyle= "-", label='Work Start Time')
handle3 = plt.Line2D([0], [0], color = 'red', linestyle= "-", label='Work End Time')
plt.legend(handles=[handle1,handle2, handle3])

# Save the figure
plt.savefig("GPU_temperature_overtime", format='svg')

# Display the plot
plt.show()


